# Что нужно сделать
## 1. Декомпозируйте приложение на микросервисы. 
Основывайте решение на доменах и границах контекстов, которые вы выделили в предыдущем задании, разбейте систему на новые микросервисы. При этом также учитывайте и бизнес-цели компании — они могут потребовать разработки микросервисов с нуля. У вас должны получиться домены как для As-Is решения, так и для To-Be. В ходе декомпозиции ориентируйтесь на наилучшие практики архитектуры микросервисов и паттерны проектирования.
## 2. Определите взаимодействия между:
микросервисами,
API Gateway,
шиной данных (например, Kafka), если вы решили её использовать,
базой данных.
## 3. Визуализируйте архитектуры:
C4 — Уровень контейнеров (Containers). Создайте диаграмму, показывающую основные контейнеры (приложения, базы данных, очереди сообщений) и их взаимодействие.
C4 — Уровень компонентов (Components). Детализируйте взаимодействие внутри выбранных микросервисов, выделив ключевые компоненты и их ответственности. Например, для микросервиса «Управление устройствами» можно выделить такие компоненты: API, обработчик команд, менеджер состояния устройств.
C4 — Уровень кода (Code). Для самых критичных частей системы можете создать диаграммы на уровне кода (например, UML диаграммы классов или последовательностей), чтобы детально показать, как они реализованы. Необязательно описывать весь код — выберите только самые критичные части.


## Задание 1.
### As-Is 
Текущая архитектура представляет собой монолитное приложение, которое включает в себя функциональность управления отоплением и сбора данных о температуре. Важно отметить, что в текущем решении отсутствуют возможности для расширяемости и интеграции с другими устройствами или системами.

В рамках текущего решения можно выделить следующие основные модули:
- Управление Отоплением
- Функциональность для контроля и мониторинга отопительных устройств.
- Сбор Данных

Запросы к датчикам и реле для получения текущей информации о состоянии и температуре.
Пользовательский Интерфейс

Простая визуализация данных о температуре и управления отопительной системой.
Каждый из этих модулей в рамках монолита не изолирован и взаимодействует синхронно.

### To-Be 
Для новой экосистемы, основанной на архитектуре микросервисов, выделяем более детализированные и независимые микросервисы. Вырисовывается следующая картина:

1. Домен “Управление Устройствами”
Микросервис “Управление Устройствами” - для регистрации, управления и настройки умных устройств.
Микросервис “Интеграция Устройств” - для обработки запросов от устройств партнёров и поддержки стандартных протоколов.

2. Домен “Мониторинг и Телеметрия”
Микросервис “Сбор Данных” - отвечает за сбор данных от всех подключенных устройств и хранение их в БД.
Микросервис “Анализ Данных” - для обработки и анализа собранных данных, а также генерации отчетов и уведомлений.
Брокер очередей (например, Kafka) - для асинхронной обработки сигналов от устройств для распределения нагрузки.

3. Домен “Управление Операциями”
Микросервис “Управление Сценариями” - логика автоматизации и сценариев работы устройства (например, создание триггеров и сценариев).
Микросервис “Исполнение Команд” - обработка команд пользователя и управление состоянием устройств.
Брокер очередей (например, Kafka) - для асинхронного запуска сценариев на устройствах.

4. Домен “Управление Пользователями”
Микросервис “Пользователи и Аутентификация” - регистрация, аутентификация и управление профилями пользователей.
Микросервис “Настройки Пользователей” - хранение и управление настройками и предпочтениями пользователей.

5. Домен “Обслуживание клиентов”
Микросервис “Поддержка Пользователей” - ведение обращений и запросов от пользователей, обучение по системе и ответы на вопросы.
Микросервис “Документация” - хранение и предоставление доступа к обучающим материалам и рекомендациям по настройке.

6. Домен “Аналитика и Отчётность”
Микросервис “Аналитика” - сбор, хранение и обработка статистики для генерации отчетов по использованию системы.
Микросервис “Отчётность” - основное управление отчетами и предоставление их пользователям.
ETL (например, AirFlow) - автомизированный перелив данных по слоям DWH.



## Задание 2.
### 1. API Gateway
Роль:
API Gateway будет выступать в качестве единой точки входа для клиентских приложений (веб-приложений, мобильных приложений и т.д.). Он будет маршрутизировать входящие запросы на соответствующий микросервис, обеспечивая при этом безопасность, кэширование и аутентификацию.

Взаимодействия:
Пользовательские запросы: Клиенты отправляют HTTP-запросы к API Gateway.
Маршрутизация: API Gateway маршрутизирует запросы к соответствующим микросервисам в зависимости от URL и типа запроса (GET, POST, PUT, DELETE и т.д.).
Аутентификация: Проверяет токены доступа пользователей перед передачей запросов тем микросервисам, которые требуют аутентификацию.


### 2. Микросервисы
Взаимодействия:
С синхронным вызовом: Микросервисы могут взаимодействовать напрямую, отправляя HTTP-запросы друг к другу через REST API.
С асинхронным вызовом через шину данных: Микросервисы могут также отправлять и получать сообщения через шину данных (например, Kafka) для уведомления о событиях или выполнения команд. Это идеально подходит для обработки событий, когда одна операция может привести к нескольким другим действиям. Асинхронные вызовы будут для непосредственного взаимодействия с устройствами пользователей (от устройства на наш сервер и обратно)

### 3. Шина данных (Kafka)
Роль:
Шина данных будет служить основным механизмом для асинхронной передачи сообщений между микросервисами. Это повышает надежность системы и позволяет микросервисы работать независимо друг от друга.

Взаимодействия:
Отправка событий: Когда микросервис завершается определенной задачей (например, успешно зарегистрировал новое устройство), он публикует это событие в соответствующий топик Kafka.
Подписка на события: Другие микросервисы могут подписываться на эти события и обрабатывать их в фоновом режиме (например, микросервис “Аналитика” может подписываться на события “Регистрация устройства” для обновления своей статистики).
Обработка событий: Используя потоки данных, микросервисы могут обрабатывать входящие события и инициировать соответствующие действия.

### 4. База данных
Роль:
Каждый микросервис будет иметь свою собственную базу данных (DataBase per Service) (или использовать общую, если это уместно), что способствует независимости и модульности.

Взаимодействия:
Чтение и запись данных: Микросервисы взаимодействуют с базой данных для сохранения, обновления и получения данных (например, микросервис “Управление Устройствами” будет хранить информацию о зарегистрированных устройствах).
Синхронизация данных: В случаях, когда требуется обширное взаимодействие между микросервисами, возможно использование события “Синхронизация данных” через Kafka для передачи данных между базами данных разных микросервисов (например, при изменении профиля пользователя в “Пользователи и Аутентификация”, информация должна быть обновлена во всех связанных микросервисах).


## Задание 3.
Диаграммы C4 представлены на уровне текущей директории.